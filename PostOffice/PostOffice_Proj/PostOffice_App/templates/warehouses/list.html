{% extends 'base.html' %}
{% block title %}Warehouses — Mailly{% endblock %}
{% block content %}
<div class="card">
  <div style="display:flex; justify-content:space-between; align-items:center;">
    <h3 style="margin:0;">Warehouses</h3>
    {% if request.user.role == 'admin' %}
      <a class="btn btn-primary" href="{% url 'warehouses_create' %}">
        <i class="fa fa-plus"></i> Add Warehouse
      </a>

      <a href="{% url 'warehouses_export_json' %}" class="btn btn-secondary">Export JSON</a>
      <a href="{% url 'warehouses_import_json' %}" class="btn btn-secondary">Import JSON</a>

      <!-- Botón añadido para Export CSV -->
      <a href="{% url 'warehouses_export_csv' %}" class="btn btn-info">
        Export CSV
      </a>

    {% endif %}
  </div>

  <table class="table" style="margin-top:16px;">
    <thead>
      <tr>
        <th>Name</th>
        <th>Address</th>
        <th>Contact</th>
        <th>Open</th>
        <th>Close</th>
        <th>Capacity</th>
        <th style="text-align:right;">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for w in warehouses %}
        <tr>
          <td><strong>{{ w.name }}</strong></td>
          <td class="muted">{{ w.address }}</td>
          <td class="muted">{{ w.contact }}</td>
          <td class="muted">{{ w.po_schedule_open }}</td>
          <td class="muted">{{ w.po_schedule_close }}</td>
          <td class="muted">{{ w.maximum_storage_capacity }}</td>
          <td style="text-align:right;">
            {% if request.user.role == 'admin' or request.user.role == 'staff' %}
              <a class="btn" href="{% url 'warehouses_edit' w.id %}">Edit</a>
            {% endif %}
            {% if request.user.role == 'admin' %}
              <form method="post" action="{% url 'warehouses_delete' w.id %}" style="display:inline;">
                {% csrf_token %}
                <button class="btn" type="submit" onclick="return confirm('Delete this warehouse?');">Delete</button>
              </form>
            {% endif %}
          </td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="7" class="muted" style="text-align:center; padding:16px;">No warehouses found</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
